{"version":3,"file":"map.component.js","sourceRoot":"","sources":["../../../Users/gusdev/code/rumpel/tmp/broccoli_type_script_compiler-input_base_path-f2J48Fb3.tmp/0/src/app/dataViews/map/map.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnInit, OnChanges, Input, Output, EventEmitter } from '@angular/core';\n\ndeclare var L: any;\n\n@Component({\n  moduleId: module.id,\n  selector: 'rump-map',\n  templateUrl: 'map.component.html',\n  styleUrls: ['map.component.css']\n})\nexport class MapComponent implements OnInit, OnChanges {\n  @Input() locations;\n  @Input() mapSize: string;\n  @Output() timeSelected = new EventEmitter<any>();\n\n  private map;\n  private markers = L.markerClusterGroup();\n  private bbox = {\n    minLng: 180,\n    maxLng: -180,\n    minLat: 180,\n    maxLat: -180\n  };\n\n  constructor() {}\n\n  ngOnInit() {\n    const osmUrl = 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';\n    const osmAttrib = 'Map data &copy; <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors,' +\n      ' <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>,';\n\n    this.map = L.map('map-view', { zoomControl: false }).setView([51.5074, 0.1278], 10);\n    let map = this.map;\n    setTimeout(function(){ map.invalidateSize()}, 400);\n\n    L.tileLayer(osmUrl, { attribution: osmAttrib, minZoom: 3, maxZoom: 18 }).addTo(this.map);\n  }\n\n  ngOnChanges() {\n    if (this.map) this.updateMap(this.locations);\n  }\n\n  updateMap(locations: Array<any>) {\n    if (locations.length <= 0) return;\n    this.drawMarkers(locations);\n    this.map.fitBounds([\n      [this.bbox.minLat, this.bbox.minLng],\n      [this.bbox.maxLat, this.bbox.maxLng]\n    ]);\n  }\n\n  resetBoundingBox() {\n    this.bbox.minLat = 180; this.bbox.maxLat = -180;\n    this.bbox.minLng = 180; this.bbox.maxLng = -180;\n  }\n\n  ajustBoundingBox(lat: number, lng: number) {\n      this.bbox.minLat = Math.min(this.bbox.minLat, lat);\n      this.bbox.maxLat = Math.max(this.bbox.maxLat, lat);\n      this.bbox.minLng = Math.min(this.bbox.minLng, lng);\n      this.bbox.maxLng = Math.max(this.bbox.maxLng, lng);\n    }\n\n  drawMarkers(locations: Array<any>) {\n      this.map.removeLayer(this.markers);\n      this.markers = L.markerClusterGroup();\n      this.resetBoundingBox();\n      for(let loc of locations) {\n        this.ajustBoundingBox(loc.latitude, loc.longitude);\n        let pos = new L.LatLng(loc.latitude, loc.longitude);\n        let marker = L.marker(pos);\n        marker.timestamp = loc.start;\n        let self = this;\n        marker.on('click', (e: any) => {\n          self.onMarkerSelected(e);\n        });\n        this.markers.addLayer(marker);\n      }\n\n    this.map.addLayer(this.markers);\n    }\n\n  onMarkerSelected(e: any) {\n    this.timeSelected.emit(e.target.timestamp);\n  }\n}"]}